<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>openPMD_raytrace_API: /opt/panosc/openPMD_extension/openPMD_raytrace_API/src/openPMD_io.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">openPMD_raytrace_API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">openPMD_io.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="openPMD__io_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rays_8hh.html">rays.hh</a>&quot;</span> <span class="comment">// helper class that stores the rays and returns 1D vectors</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="openPMD__io_8hh.html">openPMD_io.hh</a>&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="openPMD__io_8cc.html#aea3cfda4f3a9f978ec759f206cf186fe">   10</a></span>&#160;<span class="preprocessor">#define CHUNK_SIZE 10000</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">const</span> std::map&lt;openPMD_output_format_t, std::string&gt; openPMD_io::output_format_names = {</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        {JSON, <span class="stringliteral">&quot;json&quot;</span>},</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        {HDF5, <span class="stringliteral">&quot;h5&quot;</span>},</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;};</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classopenPMD__io.html#a5777d4e875a09c7d3e179389a24aa33d">   22</a></span>&#160;<a class="code" href="classopenPMD__io.html#a5777d4e875a09c7d3e179389a24aa33d">openPMD_io::openPMD_io</a>(<span class="keyword">const</span> std::string&amp; filename, openPMD::Access read_mode, std::string mc_code_name,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                       std::string mc_code_version, std::string instrument_name,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                       std::string name_current_component, <span class="keywordtype">int</span> repeat):</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    _name(filename),</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    _mc_code_name(mc_code_name),</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    _mc_code_version(mc_code_version),</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    _instrument_name(instrument_name),</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    _name_current_component(name_current_component),</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    _i_repeat(1),</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    _n_repeat(repeat),</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    _access_mode(read_mode),</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    _offset({0}),</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    _series(<span class="keyword">nullptr</span>){};</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;openPMD_io::init_ray_prop(std::string name, openPMD::Dataset&amp; dataset, <span class="keywordtype">bool</span> isScalar,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                          std::map&lt;openPMD::UnitDimension, double&gt; <span class="keyword">const</span>&amp; dims, <span class="keywordtype">double</span> unitSI) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keyword">auto</span> rays = rays_pmd();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    rays[name].setUnitDimension(dims);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (isScalar) {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        rays[name][openPMD::RecordComponent::SCALAR].resetDataset(dataset);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        rays[name][openPMD::RecordComponent::SCALAR].setUnitSI(unitSI);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">// now define the RECORD_COMPONENT</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> dim : {<span class="stringliteral">&quot;x&quot;</span>, <span class="stringliteral">&quot;y&quot;</span>, <span class="stringliteral">&quot;z&quot;</span>}) {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            rays[name][dim].resetDataset(dataset);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            rays[name][dim].setUnitSI(unitSI);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span><span class="keywordtype">void</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;openPMD_io::init_rays(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_rays) {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// auto i = iter_pmd();</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// series.setAttribute(&quot;dinner&quot;, &quot;Pizza and Coke&quot;);</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// i.setAttribute(&quot;vacuum&quot;, true);</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">auto</span> rays = rays_pmd();</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    rays.setAttribute(<span class="stringliteral">&quot;speciesType&quot;</span>, <span class="stringliteral">&quot;2112&quot;</span>);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    rays.setAttribute(<span class="stringliteral">&quot;PDGID&quot;</span>, <span class="stringliteral">&quot;2112&quot;</span>);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// declare the dataset total size: the final size</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    openPMD::Dataset dataset = openPMD::Dataset(openPMD::Datatype::FLOAT, openPMD::Extent{n_rays});</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;position&quot;</span>, dataset, <span class="keyword">false</span>, {{openPMD::UnitDimension::L, 1.}}, 1e-2);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;direction&quot;</span>, dataset, <span class="keyword">false</span>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;polarization&quot;</span>, dataset, <span class="keyword">false</span>);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// now set the scalars</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;weight&quot;</span>, dataset, <span class="keyword">true</span>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;time&quot;</span>, dataset, <span class="keyword">true</span>, {{openPMD::UnitDimension::T, 1.}}, 1e-3);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    init_ray_prop(<span class="stringliteral">&quot;wavelength&quot;</span>, dataset, <span class="keyword">true</span>,</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                  {{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                           openPMD::UnitDimension::M,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                           1,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                   },</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                   {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                           openPMD::UnitDimension::L,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                           2,</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                   },</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                   {openPMD::UnitDimension::T, -2}},</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                  1.6021766e-13); <span class="comment">// MeV</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classopenPMD__io.html#adcb845876bd6737d48defeeebb1c6647">   98</a></span>&#160;<a class="code" href="classopenPMD__io.html#adcb845876bd6737d48defeeebb1c6647">openPMD_io::init_write</a>(<a class="code" href="openpmd__output__formats_8h.html#a5619a6874565f2b1ff52c03c49771288">openPMD_output_format_t</a> extension, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_rays,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    std::string filename = _name;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    std::string a        = output_format_names.find(extension)-&gt;second;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    filename += std::string(<span class="stringliteral">&quot;.&quot;</span>) + a;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// assign the global variable to keep track of it</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    _series =</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            std::unique_ptr&lt;openPMD::Series&gt;(<span class="keyword">new</span> openPMD::Series(filename, openPMD::Access::CREATE));</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    _series-&gt;setAuthor(<span class="stringliteral">&quot;openPMD output component&quot;</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="comment">// latticeName: name of the instrument</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// latticeFile: name of the instrument file</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// branchIndex: unique index number assigned to the latice branch the[article is in. (it should</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// be per particle</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Filename: &quot;</span> &lt;&lt; filename &lt;&lt; std::endl; <span class="comment">// remove</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// set the mccode, mccode_version, component name, instrument name</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    init_rays(iter, n_rays);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="comment">// openPMD::Record mass = rays[&quot;mass&quot;];</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="comment">// openPMD::RecordComponent mass_scalar =</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// mass[openPMD::RecordComponent::SCALAR];</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// mass_scalar.resetDataset(dataset);</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    _series-&gt;flush();</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="classopenPMD__io.html#a90cf590f7834355125dce034fb6473a5">  131</a></span>&#160;<a class="code" href="classopenPMD__io.html#a90cf590f7834355125dce034fb6473a5">openPMD_io::save_write</a>(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">if</span> (_rays.<a class="code" href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">size</a>() == 0) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Number of saved rays: &quot;</span> &lt;&lt; _rays.<a class="code" href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">size</a>() &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; _rays.x().size() &lt;&lt; std::endl;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">auto</span> rays = rays_pmd();</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    openPMD::Extent extent = {_rays.<a class="code" href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">size</a>()};</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    rays[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>].storeChunk(openPMD::shareRaw(_rays.x()), _offset, extent);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    rays[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>].storeChunk(openPMD::shareRaw(_rays.y()), _offset, extent);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    rays[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>].storeChunk(openPMD::shareRaw(_rays.z()), _offset, extent);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    rays[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>].storeChunk(openPMD::shareRaw(_rays.dx()), _offset, extent);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    rays[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>].storeChunk(openPMD::shareRaw(_rays.dy()), _offset, extent);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    rays[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>].storeChunk(openPMD::shareRaw(_rays.dz()), _offset, extent);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    rays[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>].storeChunk(openPMD::shareRaw(_rays.sx()), _offset, extent);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    rays[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>].storeChunk(openPMD::shareRaw(_rays.sy()), _offset, extent);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    rays[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>].storeChunk(openPMD::shareRaw(_rays.sz()), _offset, extent);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    rays[<span class="stringliteral">&quot;time&quot;</span>][openPMD::RecordComponent::SCALAR].storeChunk(openPMD::shareRaw(_rays.time()),</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                                              _offset, extent);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    rays[<span class="stringliteral">&quot;wavelength&quot;</span>][openPMD::RecordComponent::SCALAR].storeChunk(openPMD::shareRaw(_rays.wavelength()),</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                                                _offset, extent);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    rays[<span class="stringliteral">&quot;weight&quot;</span>][openPMD::RecordComponent::SCALAR].storeChunk(openPMD::shareRaw(_rays.weight()),</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                                                _offset, extent);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    _series-&gt;flush();</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    _rays.<a class="code" href="classRays.html#acc8a0d9e4a4ddd0b47c97ab950db1414">clear</a>();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; extent.size(); ++i)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        _offset[i] += extent[i];</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;openPMD_io::load_chunk(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    _rays.<a class="code" href="classRays.html#acc8a0d9e4a4ddd0b47c97ab950db1414">clear</a>(); <span class="comment">// Necessary to set _read to zero</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">auto</span> ray_data = rays_pmd();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keyword">auto</span> x_dat = ray_data[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// Assume all have same length</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    openPMD::Extent extent = x_dat.getExtent();</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (extent[0] == 0) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;[STATUS][LoadChunk] No more data to read&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keyword">auto</span> y_dat      = ray_data[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>];</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keyword">auto</span> z_dat      = ray_data[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>];</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keyword">auto</span> dx_dat     = ray_data[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keyword">auto</span> dy_dat     = ray_data[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>];</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">auto</span> dz_dat     = ray_data[<span class="stringliteral">&quot;direction&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>];</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">auto</span> sx_dat     = ray_data[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">auto</span> sy_dat     = ray_data[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>];</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keyword">auto</span> sz_dat     = ray_data[<span class="stringliteral">&quot;polarization&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>];</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">auto</span> sPolx_dat     = ray_data[<span class="stringliteral">&quot;sPolarization&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">auto</span> sPoly_dat     = ray_data[<span class="stringliteral">&quot;sPolarization&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>];</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keyword">auto</span> sPolz_dat     = ray_data[<span class="stringliteral">&quot;sPolarization&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>];</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keyword">auto</span> pPolx_dat     = ray_data[<span class="stringliteral">&quot;pPolarization&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">auto</span> pPoly_dat     = ray_data[<span class="stringliteral">&quot;pPolarization&quot;</span>][<span class="stringliteral">&quot;y&quot;</span>];</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keyword">auto</span> pPolz_dat     = ray_data[<span class="stringliteral">&quot;pPolarization&quot;</span>][<span class="stringliteral">&quot;z&quot;</span>];</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keyword">auto</span> time_dat   = ray_data[<span class="stringliteral">&quot;time&quot;</span>][openPMD::RecordComponent::SCALAR];</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">auto</span> wavelength_dat = ray_data[<span class="stringliteral">&quot;wavelength&quot;</span>][openPMD::RecordComponent::SCALAR];</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">auto</span> weight_dat = ray_data[<span class="stringliteral">&quot;weight&quot;</span>][openPMD::RecordComponent::SCALAR];</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">// Missing polarization vector</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    openPMD::Extent chunk_size = {(extent[0] &gt; <a class="code" href="openPMD__io_8cc.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a>) ? <a class="code" href="openPMD__io_8cc.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a> : extent[0]};</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;  Loading chunk of size &quot;</span> &lt;&lt; chunk_size[0] &lt;&lt; <span class="stringliteral">&quot;; file contains &quot;</span> &lt;&lt; extent[0]</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;              &lt;&lt; <span class="stringliteral">&quot; entries of type &quot;</span> &lt;&lt; x_dat.getDatatype() &lt;&lt; std::endl;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">/* I don&#39;t understand....</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">     * the data type info is embedded in the data... so why do we need to declare loadChunk&lt;float&gt;?</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">     * it should overload to the right function... and return the correct datatype.</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keyword">auto</span> all_x_data  = x_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keyword">auto</span> all_y_data  = y_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">auto</span> all_z_data  = z_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">auto</span> all_dx_data = dx_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keyword">auto</span> all_dy_data = dy_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">auto</span> all_dz_data = dz_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keyword">auto</span> all_sx_data = sx_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="keyword">auto</span> all_sy_data = sy_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">auto</span> all_sz_data = sz_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keyword">auto</span> all_sPolx_data = sPolx_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keyword">auto</span> all_sPoly_data = sPoly_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keyword">auto</span> all_sPolz_data = sPolz_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keyword">auto</span> all_pPolx_data = pPolx_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keyword">auto</span> all_pPoly_data = pPoly_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">auto</span> all_pPolz_data = pPolz_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keyword">auto</span> time_data   = time_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">auto</span> wavelength_data = wavelength_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">auto</span> weight_data = weight_dat.loadChunk&lt;<span class="keywordtype">float</span>&gt;(_offset, chunk_size);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="comment">// Missing polarization vector</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    _series-&gt;flush();</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// Store openPMD data in rays particle instance</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> index = 0; index &lt; chunk_size[0]; index++) {</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        _rays.<a class="code" href="classRays.html#aa129f4b4cc0f2d527e4c71267a22c0bb">store</a>(all_x_data.get()[index], all_y_data.get()[index],</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    all_z_data.get()[index], <span class="comment">//</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                    all_dx_data.get()[index], all_dy_data.get()[index],</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    all_dz_data.get()[index], <span class="comment">//</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    all_sx_data.get()[index], all_sy_data.get()[index],</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    all_sz_data.get()[index], <span class="comment">//</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    all_sPolx_data.get()[index], all_sPoly_data.get()[index],</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    all_sPolz_data.get()[index], <span class="comment">//</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    all_pPolx_data.get()[index], all_pPoly_data.get()[index],</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    all_pPolz_data.get()[index], <span class="comment">//</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    wavelength_data.get()[index], time_data.get()[index],</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    weight_data.get()[index] );</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span></div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="classopenPMD__io.html#ade5bb209a638ecc2685167bec1de6356">  251</a></span>&#160;<a class="code" href="classopenPMD__io.html#ade5bb209a638ecc2685167bec1de6356">openPMD_io::init_read</a>(<a class="code" href="openpmd__output__formats_8h.html#a5619a6874565f2b1ff52c03c49771288">openPMD_output_format_t</a> extension, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> n_rays,</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> iter) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    std::string filename = _name;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="comment">// assign the global variable to keep track of it</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    _series = std::unique_ptr&lt;openPMD::Series&gt;(</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="keyword">new</span> openPMD::Series(filename, openPMD::Access::READ_ONLY));</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;File information: &quot;</span> &lt;&lt; filename &lt;&lt; std::endl;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (_series-&gt;containsAttribute(<span class="stringliteral">&quot;author&quot;</span>))</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;  Author  : &quot;</span> &lt;&lt; _series-&gt;author() &lt;&lt; std::endl;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;  Filename: &quot;</span> &lt;&lt; filename &lt;&lt; std::endl;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;  Number of iterations: &quot;</span> &lt;&lt; _series-&gt;iterations.size() &lt;&lt; std::endl;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> (_series-&gt;iterations.size() == 0)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;  ERROR, no iterations found in openPMD series&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">if</span> (_series-&gt;iterations.size() &gt; 1)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;  WARNING, several iterations found in openPMD series, only 1 is used.&quot;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                  &lt;&lt; std::endl;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// check the maximum number of rays stored</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keyword">auto</span> ray_data          = rays_pmd();</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keyword">auto</span> x_dat             = ray_data[<span class="stringliteral">&quot;position&quot;</span>][<span class="stringliteral">&quot;x&quot;</span>];</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    openPMD::Extent extent = x_dat.getExtent();</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    _rays.<a class="code" href="classRays.html#acc8a0d9e4a4ddd0b47c97ab950db1414">clear</a>(); <span class="comment">// Necessary to set _read to zero</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">return</span> extent[0];</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#ifdef SHERVIN</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<a class="code" href="classopenPMD__io.html#aa65eb51d15e1b7a436dc0c65af37aa46">openPMD_io::trace_read</a>(<span class="keywordtype">double</span>* x, <span class="keywordtype">double</span>* y, <span class="keywordtype">double</span>* z, <span class="keywordtype">double</span>* sx, <span class="keywordtype">double</span>* sy, <span class="keywordtype">double</span>* sz, <span class="keywordtype">double</span>* vx,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                       <span class="keywordtype">double</span>* vy, <span class="keywordtype">double</span>* vz, <span class="keywordtype">double</span>* t, <span class="keywordtype">double</span>* p) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (_rays.<a class="code" href="classRays.html#a8bd14c51977bd52228c1253408a0ab9d">is_chunk_finished</a>()) load_chunk(); <span class="comment">// proceed with a new chunk</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (_rays.<a class="code" href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">size</a>() == 0) <span class="keywordflow">return</span>;               <span class="comment">// there was nothing more to read</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">/* returning the values of the last ray again</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">     * this is to allow repeting rays to be used</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (_i_repeat &lt; _n_repeat) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        _rays.retrieve(x, y, z, sx, sy, sz, vx, vy, vz, t, p);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        ++_i_repeat;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">// Get ray state from rays particle instance</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        _rays.retrieve_next(x, y, z, sx, sy, sz, vx, vy, vz, t,</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                            p); <span class="comment">// Will loop internally if more than data size is read</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        _i_repeat = 1;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">//------------------------------------------------------------</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<a class="code" href="classopenPMD__io.html#a4a668b1e217e4c0771ffeacb05030d9f">openPMD_io::trace_write</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> z,    <span class="comment">//</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                        <span class="keywordtype">double</span> sx, <span class="keywordtype">double</span> sy, <span class="keywordtype">double</span> sz, <span class="comment">//</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                        <span class="keywordtype">double</span> vx, <span class="keywordtype">double</span> vy, <span class="keywordtype">double</span> vz, <span class="comment">//</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                        <span class="keywordtype">double</span> t, <span class="keywordtype">double</span> p) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    _rays.push_back(x, y, z, sx, sy, sz, vx, vy, vz, t, p);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">if</span> (_rays.<a class="code" href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">size</a>() &gt;= <a class="code" href="openPMD__io_8cc.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a>) <a class="code" href="classopenPMD__io.html#a90cf590f7834355125dce034fb6473a5">save_write</a>();</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="classRays_html_aa129f4b4cc0f2d527e4c71267a22c0bb"><div class="ttname"><a href="classRays.html#aa129f4b4cc0f2d527e4c71267a22c0bb">Rays::store</a></div><div class="ttdeci">void store(float x, float y, float z, float dx, float dy, float dz, float sx, float sy, float sz, float sPolx, float sPoly, float sPolz, float pPolx, float pPoly, float pPolz, float wavelength, float t, float p)</div><div class="ttdoc">append a new ray to the internal memory reading from openPMD data </div><div class="ttdef"><b>Definition:</b> <a href="rays_8cc_source.html#l00054">rays.cc:54</a></div></div>
<div class="ttc" id="classopenPMD__io_html_aa65eb51d15e1b7a436dc0c65af37aa46"><div class="ttname"><a href="classopenPMD__io.html#aa65eb51d15e1b7a436dc0c65af37aa46">openPMD_io::trace_read</a></div><div class="ttdeci">Ray trace_read(void) const</div><div class="ttdoc">read one ray from file </div></div>
<div class="ttc" id="classRays_html_a6b9d557ce14e30eb944e57c1ce3e2df5"><div class="ttname"><a href="classRays.html#a6b9d557ce14e30eb944e57c1ce3e2df5">Rays::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">returns the number of stored rays </div><div class="ttdef"><b>Definition:</b> <a href="rays_8hh_source.html#l00095">rays.hh:95</a></div></div>
<div class="ttc" id="classopenPMD__io_html_a4a668b1e217e4c0771ffeacb05030d9f"><div class="ttname"><a href="classopenPMD__io.html#a4a668b1e217e4c0771ffeacb05030d9f">openPMD_io::trace_write</a></div><div class="ttdeci">void trace_write(Ray this_ray)</div><div class="ttdoc">save ray properties </div></div>
<div class="ttc" id="openPMD__io_8hh_html"><div class="ttname"><a href="openPMD__io_8hh.html">openPMD_io.hh</a></div></div>
<div class="ttc" id="classopenPMD__io_html_adcb845876bd6737d48defeeebb1c6647"><div class="ttname"><a href="classopenPMD__io.html#adcb845876bd6737d48defeeebb1c6647">openPMD_io::init_write</a></div><div class="ttdeci">void init_write(openPMD_output_format_t output_format, unsigned long long int n_rays, unsigned int iter=1)</div><div class="ttdoc">initializes the &quot;series&quot; object from the openPMD API in WRITE MODE </div><div class="ttdef"><b>Definition:</b> <a href="openPMD__io_8cc_source.html#l00098">openPMD_io.cc:98</a></div></div>
<div class="ttc" id="classopenPMD__io_html_a90cf590f7834355125dce034fb6473a5"><div class="ttname"><a href="classopenPMD__io.html#a90cf590f7834355125dce034fb6473a5">openPMD_io::save_write</a></div><div class="ttdeci">void save_write(void)</div><div class="ttdoc">Flushes the output to file before closing it. </div><div class="ttdef"><b>Definition:</b> <a href="openPMD__io_8cc_source.html#l00131">openPMD_io.cc:131</a></div></div>
<div class="ttc" id="classopenPMD__io_html_ade5bb209a638ecc2685167bec1de6356"><div class="ttname"><a href="classopenPMD__io.html#ade5bb209a638ecc2685167bec1de6356">openPMD_io::init_read</a></div><div class="ttdeci">unsigned long long int init_read(openPMD_output_format_t output_format, unsigned long long int n_rays, unsigned int iter=1)</div><div class="ttdoc">initializes the &quot;series&quot; object from the openPMD API in READ MODE </div><div class="ttdef"><b>Definition:</b> <a href="openPMD__io_8cc_source.html#l00251">openPMD_io.cc:251</a></div></div>
<div class="ttc" id="openpmd__output__formats_8h_html_a5619a6874565f2b1ff52c03c49771288"><div class="ttname"><a href="openpmd__output__formats_8h.html#a5619a6874565f2b1ff52c03c49771288">openPMD_output_format_t</a></div><div class="ttdeci">openPMD_output_format_t</div><div class="ttdoc">list of implemented openPMD backends/extensions </div><div class="ttdef"><b>Definition:</b> <a href="openpmd__output__formats_8h_source.html#l00007">openpmd_output_formats.h:7</a></div></div>
<div class="ttc" id="openPMD__io_8cc_html_aea3cfda4f3a9f978ec759f206cf186fe"><div class="ttname"><a href="openPMD__io_8cc.html#aea3cfda4f3a9f978ec759f206cf186fe">CHUNK_SIZE</a></div><div class="ttdeci">#define CHUNK_SIZE</div><div class="ttdoc">defines the maximum number of rays that can be stored in memory before dumping to file ...</div><div class="ttdef"><b>Definition:</b> <a href="openPMD__io_8cc_source.html#l00010">openPMD_io.cc:10</a></div></div>
<div class="ttc" id="rays_8hh_html"><div class="ttname"><a href="rays_8hh.html">rays.hh</a></div></div>
<div class="ttc" id="classRays_html_a8bd14c51977bd52228c1253408a0ab9d"><div class="ttname"><a href="classRays.html#a8bd14c51977bd52228c1253408a0ab9d">Rays::is_chunk_finished</a></div><div class="ttdeci">bool is_chunk_finished(void)</div><div class="ttdoc">check if all the data have been already retrieved </div><div class="ttdef"><b>Definition:</b> <a href="rays_8hh_source.html#l00101">rays.hh:101</a></div></div>
<div class="ttc" id="classRays_html_acc8a0d9e4a4ddd0b47c97ab950db1414"><div class="ttname"><a href="classRays.html#acc8a0d9e4a4ddd0b47c97ab950db1414">Rays::clear</a></div><div class="ttdeci">void clear(void)</div><div class="ttdoc">reset the container, removing all the rays </div><div class="ttdef"><b>Definition:</b> <a href="rays_8hh_source.html#l00065">rays.hh:65</a></div></div>
<div class="ttc" id="classopenPMD__io_html_a5777d4e875a09c7d3e179389a24aa33d"><div class="ttname"><a href="classopenPMD__io.html#a5777d4e875a09c7d3e179389a24aa33d">openPMD_io::openPMD_io</a></div><div class="ttdeci">openPMD_io(const std::string &amp;filename, openPMD::Access read_mode, std::string mc_code_name=&quot;&quot;, std::string mc_code_version=&quot;&quot;, std::string instrument_name=&quot;&quot;, std::string name_current_component=&quot;&quot;, int repeat=1)</div><div class="ttdoc">constructor </div><div class="ttdef"><b>Definition:</b> <a href="openPMD__io_8cc_source.html#l00022">openPMD_io.cc:22</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
